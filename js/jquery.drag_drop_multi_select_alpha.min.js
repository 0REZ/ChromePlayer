/**
 * Multi-Select, Drag And Drop
 * Work on all browser platform including IE6
 * Version Alpha 0.1
 * Its a plugin that combine all the jquery-ui (Drag,Drop,Select);
 * You need the custom $.UI to be able to use this
 * You need to add this to your style-sheet
 * .ui-selectable-helper {}
 * .ui-selectable-helper div {}
 * There's no major change in $.UI since its just to adapt some of the plugins
 * Please leave me some comment on anything!
 *
 * Copyright (c) 2010 Samuel Clé§»oux-Bouthillier
 *
 * Dual licensed under MIT and GNU General Public License version 3 (GPLv3)
 * http://www.opensource.org/licenses
 * Launch : September 2010
 */
(function(a){var g;a.fn.exists=function(){return jQuery(this).length==0?false:true};a.fn.drag_drop_multi_select=function(b){var c=a.fn.drag_drop_multi_select.defaults;if(b)c=a.extend(a.fn.drag_drop_multi_select.defaults,b);return this.each(function(){var e=a.fn.drag_drop_multi_select.unique++;g=a(this);g.attr("ddms",e);a.fn.captureKeys();a.fn.drag_drop_multi_select.stack[e]={selected:[],all:[]};a.fn.drag_drop_multi_select.settings[e]=c;g.find(c.element_to_drag_drop_select).each(function(){var d=a(this),
f=a.fn.drag_drop_multi_select.unique++;d.attr("ddms",f);a.fn.drag_drop_multi_select.settings["item_"+d.attr("ddms")]={self:d,parent_to_refer:g};a.fn.drag_drop_multi_select.stack[e].all.push(f);d.bind("click.ddms_item_clicked",function(h){a(".last-select").removeClass("last-select");h.ctrlKey?a.fn.drag_drop_multi_select.toggle(f):a.fn.drag_drop_multi_select.replace(f)});d.bind("ddms.select",function(){a(this).addClass("ui-selected");a(this).addClass(a.fn.drag_drop_multi_select.settings[a.fn.drag_drop_multi_select.get_instance_id(a(this).attr("ddms"))].selectedClass);
a(this).addClass("last-select");g.find(".ui-selected").size()==0?a(c.element_to_show_result).text(""):a(c.element_to_show_result).text(g.find(".ui-selected").size()+" items are selected")});d.bind("ddms.deselect",function(){a(this).removeClass("ui-selected");a(this).removeClass(a.fn.drag_drop_multi_select.settings[a.fn.drag_drop_multi_select.get_instance_id(a(this).attr("ddms"))].selectedClass);g.find(".ui-selected").size()==0?a(c.element_to_show_result).text(""):a(c.element_to_show_result).text(g.find(".ui-selected").size()+
" items are selected")})});g.selectable({cancel:"'"+c.elements_to_cancel_select+","+c.element_to_drag_drop_select+"'",filter:g.find(c.element_to_drag_drop_select),selecting:function(){g.find(".ui-selecting").size()==0?a(c.element_to_show_result).text(""):a(c.element_to_show_result).text(g.find(".ui-selecting").size()+" items are in the selection")},unselecting:function(){g.find(".ui-selecting").size()==0?a(c.element_to_show_result).text(""):a(c.element_to_show_result).text(g.find(".ui-selecting").size()+
" items are in the selection")},stop:function(){g.find(".ui-selected").size()==0?a(c.element_to_show_result).text(""):a(c.element_to_show_result).text(g.find(".ui-selected").size()+" items are selected")},selected:function(d,f){a.fn.drag_drop_multi_select.select(parseInt(a(f.selected).attr("ddms")))},unselected:function(d,f){a.fn.drag_drop_multi_select.deselect(parseInt(a(f.unselected).attr("ddms")))}});g.find(c.element_to_drag_drop_select).draggable({helper:function(){$clicked_item=a(this);$clicked_item.hasClass("ddms_selected")||
$clicked_item.trigger("click.ddms_item_clicked");var d=a.fn.drag_drop_multi_select.get_instance_id($clicked_item.attr("ddms")),f=a('<div ddms_instance="'+d+'"></div>').append('<div class="inside_helper" style="position:absolute;top:-'+a.fn.drag_drop_multi_select.getTopOffset($clicked_item)+"px;left:-"+a.fn.drag_drop_multi_select.getLeftOffset($clicked_item)+'px;" ></div>');f.find(".inside_helper").append(a.fn.drag_drop_multi_select.getSelectedForDragging($clicked_item.attr("ddms")));a.fn.drag_drop_multi_select.getListItems(d).filter(a.fn.drag_drop_multi_select.settings[d].selectedClass).addClass(a.fn.drag_drop_multi_select.settings[d].ghostClass);
return f},cursor:"move",revert:"invalid",scroll:false,start:function(){},drag:function(){},stop:function(){$clicked_item=a(this);var d=a.fn.drag_drop_multi_select.get_instance_id($clicked_item.attr("ddms"));a.fn.drag_drop_multi_select.getListItems(d).filter(a.fn.drag_drop_multi_select.settings[d].selectedClass).removeClass(a.fn.drag_drop_multi_select.settings[d].ghostClass)}});var i=[];a(c.elements_to_drop).droppable({tolerance:"pointer",over:function(d,f){var h=a(d.target),j=parseInt(f.helper.attr("ddms_instance"));
i=[];a.fn.drag_drop_multi_select.getListItems(j).filter(c.selectedClass).each(function(){i.push(a(this).attr("ddms"))});a.inArray(h.attr("ddms"),i);h.addClass(a.fn.drag_drop_multi_select.settings[e].hoverClass)},out:function(d){a(d.target).removeClass(a.fn.drag_drop_multi_select.settings[e].hoverClass)},drop:function(d,f){a(d.target).removeClass(a.fn.drag_drop_multi_select.settings[e].hoverClass);var h=parseInt(f.helper.attr("ddms_instance"));f.helper.find(".inside_helper ."+c.selectedClass).each(function(){var j=
parseInt(a(this).attr("ddms_drag"));a.fn.drag_drop_multi_select.moveBetweenLists(j,a.fn.drag_drop_multi_select.settings["item_"+j].self,h,e,d,f)})}})})};a.fn.drag_drop_multi_select.defaults={element_to_drag_drop_select:".ddms",elements_to_cancel_select:".cancel",elements_to_drop:".drop",element_to_show_result:".items_selected",moveOpacity:0.5,ghostClass:"ddms_ghost",hoverClass:"ddms_hover",moveClass:"ddms_move",selectedClass:"ddms_selected",after_drop_action:function(){}};a.fn.drag_drop_multi_select.unique=
0;a.fn.drag_drop_multi_select.stack=[];a.fn.drag_drop_multi_select.settings=[];a.fn.drag_drop_multi_select.moveBetweenLists=function(b,c,e,i,d,f){var h=a.fn.drag_drop_multi_select.get_instance_id(b);a.fn.drag_drop_multi_select.deselect(parseInt(b));a(a.fn.drag_drop_multi_select.settings[h].element_to_show_result).text("");var j=a("[ddms="+e+"]"),k=a("[ddms="+i+"]");a.fn.drag_drop_multi_select.settings[h].after_drop_action(c,j,k,d,f);a.fn.drag_drop_multi_select.stack[e].all.splice(a.inArray(parseInt(b),
a.fn.drag_drop_multi_select.stack[e].all),1);a.fn.drag_drop_multi_select.stack[i].all.push(parseInt(b))};a.fn.drag_drop_multi_select.getSelectedForDragging=function(b){var c=a.fn.drag_drop_multi_select.get_instance_id(b);return a.fn.drag_drop_multi_select.getListItems(c).clone().each(function(){var e=a(this).attr("ddms");a(this).not("."+a.fn.drag_drop_multi_select.settings[c].selectedClass).hide();a(this).filter("."+a.fn.drag_drop_multi_select.settings[c].selectedClass).addClass(a.fn.drag_drop_multi_select.settings[c].moveClass).css({opacity:a.fn.drag_drop_multi_select.settings[c].moveOpacity});
a(this).attr("ddms_drag",a(this).attr("ddms"));a(this).attr("ddms","");a(this).css({position:"absolute",left:a('[ddms="'+e+'"]').position().left,top:a('[ddms="'+e+'"]').position().top})})};a.fn.drag_drop_multi_select.getTopOffset=function(b){var c=b.position().top;a.fn.drag_drop_multi_select.getListItems(a.fn.drag_drop_multi_select.get_instance_id(b.attr("ddms"))).eq(0).position();return c};a.fn.drag_drop_multi_select.getLeftOffset=function(b){var c=b.position().left;a.fn.drag_drop_multi_select.getListItems(a.fn.drag_drop_multi_select.get_instance_id(b.attr("ddms"))).eq(0).position();
return c};a.fn.drag_drop_multi_select.toggle=function(b){a.fn.drag_drop_multi_select.isSelected(b)?a.fn.drag_drop_multi_select.deselect(b):a.fn.drag_drop_multi_select.select(b)};a.fn.drag_drop_multi_select.select=function(b){var c=a.fn.drag_drop_multi_select.get_instance_id(b),e=a.fn.drag_drop_multi_select.settings["item_"+b].self;if(!a.fn.drag_drop_multi_select.isSelected(b)){a.fn.drag_drop_multi_select.stack[c].selected.push(b);e.trigger("ddms.select")}};a.fn.drag_drop_multi_select.deselect=function(b){var c=
a.fn.drag_drop_multi_select.get_instance_id(b),e=a.fn.drag_drop_multi_select.settings["item_"+b].self;if(a.fn.drag_drop_multi_select.isSelected(b)){a.fn.drag_drop_multi_select.stack[c].selected.splice(a.inArray(b,a.fn.drag_drop_multi_select.stack[c].selected),1);e.trigger("ddms.deselect")}};a.fn.drag_drop_multi_select.isSelected=function(b){var c=a.fn.drag_drop_multi_select.settings["item_"+b].self;b=a.fn.drag_drop_multi_select.get_instance_id(b);return c.hasClass(a.fn.drag_drop_multi_select.settings[b].selectedClass)};
a.fn.drag_drop_multi_select.replace=function(b){var c=a.fn.drag_drop_multi_select.get_instance_id(b);a.fn.drag_drop_multi_select.selectNone(c);a.fn.drag_drop_multi_select.stack[c].selected.push(b);a.fn.drag_drop_multi_select.settings["item_"+b].self.trigger("ddms.select")};a.fn.drag_drop_multi_select.getListItems=function(b){return a("[ddms="+b+"] "+a.fn.drag_drop_multi_select.settings[b].element_to_drag_drop_select)};a.fn.drag_drop_multi_select.get_instance_id=function(b){return parseInt(a.fn.drag_drop_multi_select.settings["item_"+
b].parent_to_refer.eq(0).attr("ddms"))};a.fn.drag_drop_multi_select.serializeArray=function(b){var c=[];a.fn.drag_drop_multi_select.getListItems(b).each(function(){c.push(a(this).attr("id"))});return c};a.fn.drag_drop_multi_select.serialize=function(b){return a.fn.drag_drop_multi_select.serializeArray(b).join(", ")};a.fn.drag_drop_multi_select.selectNone=function(b){a.fn.drag_drop_multi_select.getListItems(b).each(function(){a.fn.drag_drop_multi_select.deselect(a(this).attr("ddms"))});return false};
a.fn.drag_drop_multi_select.selectAll=function(b){a.fn.drag_drop_multi_select.getListItems(b).each(function(){a.fn.drag_drop_multi_select.select(a(this).attr("ddms"))});return false};a.extend({ddms:{selectAll:function(b){return a.fn.drag_drop_multi_select.selectAll(a("#"+b).attr("ddms"))},selectNone:function(b){return a.fn.drag_drop_multi_select.selectNone(a("#"+b).attr("ddms"))},serialize:function(b){return a.fn.drag_drop_multi_select.serialize(a("#"+b).attr("ddms"))}}});a.fn.captureKeys=function(){if(!a.fn.captureKeys.capturing){a(document).keydown(function(b){if(b.keyCode==
17)a.fn.captureKeys.stack.CTRL_KEY=true;if(b.keyCode==16)a.fn.captureKeys.stack.SHIFT_KEY=true;if(b.keyCode==18)a.fn.captureKeys.stack.ALT_KEY=true});a(document).keyup(function(b){if(b.keyCode==17)a.fn.captureKeys.stack.CTRL_KEY=false;if(b.keyCode==16)a.fn.captureKeys.stack.SHIFT_KEY=false;if(b.keyCode==18)a.fn.captureKeys.stack.ALT_KEY=false})}};a.fn.captureKeys.stack={CTRL_KEY:false,SHIFT_KEY:false,ALT_KEY:false};a.fn.captureKeys.capturing=false;a.fn.keyisPressed=function(b){switch(b){case 17:return a.fn.captureKeys.stack.CTRL_KEY;
case 18:return a.fn.captureKeys.stack.ALT_KEY;case 16:return a.fn.captureKeys.stack.SHIFT_KEY;default:return false}}})(jQuery);
